<!DOCTYPE html>
<html lang="en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="generator" content="Hugo 0.54-DEV" />
	

	<title>
		 
		Mount file to Kubernetes Pod, without Deleting the Existing File — in the Docker-Container in the Same Directory-Letters From Iman
		

	</title>

	<meta property="og:title" content="Mount file to Kubernetes Pod, without Deleting the Existing File — in the Docker-Container in the Same Directory - Letters From Iman" /> 
	<meta property="og:description" content="A few weeks ago, I made a simple application named tweetor that was about a simple tutorial to create Kubenernetes Clusters in Google Cloud Platform (GCP)." />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://bxcodec.io/posts/mount-file-to-kubernetes-pod-without-deleting-the-existing-file-in-the-docker-container-in-the-same-directory/" />
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
	 crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
	<link href="/css/medium.css" rel="stylesheet">
	<link href="/css/additional.css" rel="stylesheet">
	<link rel="icon" href="https://bxcodec.io/favicon.ico">
	<link rel="apple-touch-icon" href="https://bxcodec.io/apple-touch-icon.png"/>
	
	<meta property="og:image" content="https://cdn-images-1.medium.com/max/1600/0*IyXU1OPdhZvS8f_i"/>
	<meta property="og:image:secure_url" content="https://cdn-images-1.medium.com/max/1600/0*IyXU1OPdhZvS8f_i"/>
	<meta name="twitter:card" content="summary_large_image" />
		
	<meta name="twitter:site" content="@bxcodec.io" />
	
	<meta name="twitter:creator" content="@bxcodec" />
	
	
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container pr-0">
        
        <a class="navbar-brand" href="https://bxcodec.io">

            
            <span style="font-family:Righteous;">Letters From Iman</span>
            
        </a>
        

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/posts">Blog</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/">About Me</a>
                </li>
                
            </ul>
        </div>
        
    </div>
</nav>


        <div class="site-content">   
            <div class="container">
<div class="mainheading">
    
</div><div class="main-content">
        
        <div class="container">
            <div class="row">
                
                <div class="col-md-2 pl-0"><div class="share">
    <p>Share</p>
    <ul>
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://twitter.com/intent/tweet?text=Mount%20file%20to%20Kubernetes%20Pod%2c%20without%20Deleting%20the%20Existing%20File%e2%80%8a%e2%80%94%e2%80%8ain%20the%20Docker-Container%20in%20the%20Same%20Directory&url=https%3a%2f%2fbxcodec.io%2fposts%2fmount-file-to-kubernetes-pod-without-deleting-the-existing-file-in-the-docker-container-in-the-same-directory%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=435');return false;">
        <i class="fab fa-twitter"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://facebook.com/sharer.php?u=https%3a%2f%2fbxcodec.io%2fposts%2fmount-file-to-kubernetes-pod-without-deleting-the-existing-file-in-the-docker-container-in-the-same-directory%2f" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
        <i class="fab fa-facebook-f"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://plus.google.com/share?url=https%3a%2f%2fbxcodec.io%2fposts%2fmount-file-to-kubernetes-pod-without-deleting-the-existing-file-in-the-docker-container-in-the-same-directory%2f" onclick="window.open(this.href, 'google-share', 'width=550,height=435');return false;">
        <i class="fab fa-google"></i>
        </a>
        </li>

        <li class="ml-1 mr-1">
        <a target="_blank" href="https://www.xing.com/spi/shares/new?url=https%3a%2f%2fbxcodec.io%2fposts%2fmount-file-to-kubernetes-pod-without-deleting-the-existing-file-in-the-docker-container-in-the-same-directory%2f" onclick="window.open(this.href, 'xing-share', 'width=550,height=435');return false;">
        <i class="fab fa-xing"></i>
        </a>
        </li>        
    </ul>

    
        <div class="sep">
        </div>				
        <ul>
            <li> 
            <a  class="small smoothscroll" href="#disqus_thread"></a>
            </li>
        </ul>
    
</div></div>
                                
                <div class="col-md-9 flex-first flex-md-unordered">
                    <div class="mainheading">
                                                                	
                        
                        
                        
                        <div class="post-top-meta">
                            <div>
                                <img class="author-thumb" src="http://gravatar.com/avatar/01e3584fe39eb72335f13243c3a814a2?s=200" alt="Iman Tumorang">
                            </div>
                            <div >
                                <a  href="https://bxcodec.io" class="link-dark">Iman Tumorang</a><br>
                                <span class="author-description">
                                    Software Engineer - Writer - Open Source Enthusiast - Startup Enthusiast<br>
                                    <i class="far fa-star"></i>
                                    Jan 29, 2019
                                    <i class="far fa-clock clock"></i>
                                    4 min read
                                </span>					
                            </div>
                        </div>			
                        	
                        
                                                     
                        
                        <h1 class="posttitle">Mount file to Kubernetes Pod, without Deleting the Existing File — in the Docker-Container in the Same Directory</h1> 
                        
                            <h2 class="subtitle">What I learned about Kubernetes when trying to mount config maps into a docker container that already have an existing file in the same directory.</h2> 
                        
                        
                    </div>

                    
                    
                        <img class="featured-image img-fluid" src="https://cdn-images-1.medium.com/max/1600/0*IyXU1OPdhZvS8f_i" alt="thumbnail for this post">
                    
                    
                    
                    
                    <div class="article-post">
                        

<p>A few weeks ago, I made a simple application named tweetor that was about a simple tutorial to create Kubenernetes Clusters in Google Cloud Platform (GCP). It was the part of a project I made called “Kube X-mas”. This project is a series of article written in Bahasa Indonesia to create a live application in Kubernetes at GCP, you could see the series here: <a href="https://medium.com/easyread/christmas-tale-of-sofware-engineer-project-kube-xmas-9167ebca70d2">https://medium.com/easyread/christmas-tale-of-sofware-engineer-project-kube-xmas-9167ebca70d2</a></p>

<p>In that project, I will deploy a Golang application into a Kubernetes cluster in GCP. As we know, when developing an application, it must separate its config file, whether it’s in Environment variable, or just in a config file ( .json, .yaml, .toml, etc). So it can be more flexible, we can change the environment staging, production or testing.</p>

<p>In my case, I will dockerize my application in a Docker image, then when deploying it to Kubernetes, I will use Kubernetes controller to inject the configuration file, so it can run with the injected configuration file.</p>

<p>So, basically, in Kubernetes, we can inject (mount) file into a container. In my case, I will mount a config file of my application into my docker containers. To do this, I can use the Kubernetes ConfigMap and Volumes, it allows us to inject configuration files into our docker application containers.</p>

<h2 id="the-issue">The Issue</h2>

<p>To be clear, I have a Go (Golang) application that builds and containerized in a docker image. This application already compiled and build and saved in a docker image.</p>

<p>This is my <code>Dockerfile</code>.</p>

<script src="https://gist.github.com/bxcodec/232b1c47ca3cd0a15fd0cf770ba7bad5.js"></script>

<p>So it will create a Docker image that will contain the compiled go application in <code>/app/engine</code>. But this application will need a config file, so it can run and live. I need to inject the config file so it can run.</p>

<p><img src="https://cdn-images-1.medium.com/max/1600/1*a_TDZoHdPpdNWwKuw42Wdg.png" alt="inject the config to docker container" /></p>

<blockquote>
<p>inject the config to docker container</p>
</blockquote>

<p>And then, I use the Kubernetes config maps to inject my application config file.</p>

<script src="https://gist.github.com/bxcodec/e9d4b2794fc1fd1fb23e06020a4c210c.js"></script>

<p>But, the issue then happen. What I expect is, when injecting this config file on the same path. Let’s say my working directory in the container is <code>/app</code></p>

<p>Previous:</p>

<pre><code>app
└── engine
</code></pre>

<p>What I expect after injected the config maps with mount volume:</p>

<pre><code>app
├── config.toml
└── engine
</code></pre>

<p>What it really happens:</p>

<pre><code>app
└── config.toml
</code></pre>

<p>Instead of adding a new file, the Kubernetes mount volume will replace all the file, and it removes the existing file.</p>

<p>I’m stuck in this issue for 4 hours because I don’t realize it first. My pods keep crashing and restarted. Until then, I try to debug it slowly and realized that if I mount a file that will also delete the existing file if it has the same directory.</p>

<h2 id="solutions">Solutions</h2>

<p>After realizing the issue, there are two options I can choose.</p>

<ul>
<li><p>Separate my working directory in Docker container with the directory of my application in the container. So, instead use the <code>/app</code> as my working directory in the container, I will create a new directory that will my <code>WORKDIR</code>. And I will put my config file in that folder.</p></li>

<li><p>Trying to figure out it until it solved.</p></li>
</ul>

<p>Option 1 is really obvious, and it solves the problems. At the time, when facing this issue, I use option 1. But a few days later, just out of curiosity, I try to solve option 2. I try to read again many resources (official documentation) and blog post if any kind of this issue ever happens to anyone and how to fix it.</p>

<p>But, I found nothing, except this <a href="https://blog.sebastian-daschner.com/entries/multiple-kubernetes-volumes-directory">https://blog.sebastian-daschner.com/entries/multiple-kubernetes-volumes-directory</a>. In this article, he explains about multiple Kubernetes volumes directory. So I’m curious if this will also can solve my problem.</p>

<p>In that article, he said to use <code>subPath</code>, and so be it, then I try to use the <code>subPath</code> too in my applications deployment for Kubernetes.</p>

<p>Previously:</p>

<pre><code>- name: configs          
  mountPath: /app
</code></pre>

<p>And changed into:</p>

<pre><code>- name: configs
  mountPath: /app/config.toml
  subPath: config.toml
</code></pre>

<p>And voila, it works. It does not replace and delete my existing file in the container anymore. And it can run smoothly.</p>

<p>My full Kubernetes deployment.yaml file:</p>

<script src="https://gist.github.com/bxcodec/df348766eeb730afe00ba278c81e3249.js"></script>

<p>Well, when solving this, I learn something important. Even I stuck for 4–6 hours when solving this “alone”, but I learned a valuable lesson here. And can’t look forward to the next adventure.</p>

<p><em>Anyway, if you find this useful would you mind to share this story, so everyone will not fall to the same hole. And follow me to keep updates to my learning journey in Software Engineering :)</em></p>

<h5 id="references">References:</h5>

<ul>
<li><a href="https://blog.sebastian-daschner.com/entries/multiple-kubernetes-volumes-directory">https://blog.sebastian-daschner.com/entries/multiple-kubernetes-volumes-directory</a></li>
</ul>

<hr />

<p><em>Originally posted at: <a href="https://hackernoon.com/mount-file-to-kubernetes-pod-without-deleting-the-existing-file-in-the-docker-container-in-the-88b5d11661a6">https://hackernoon.com/mount-file-to-kubernetes-pod-without-deleting-the-existing-file-in-the-docker-container-in-the-88b5d11661a6</a></em></p>

                    </div>

                    
<div class="container">
    <div id="subscribe" class="row justify-content-center mb-5">
        <div class="col-md-8">           
           <iframe style="width:100%; height:260px !important; border:none !important;" src="https://upscri.be/eec395-2"></iframe>
        </div>
    </div>
</div>


 
                    <div class="after-post-tags">
                        <ul class="tags">
                        
                        <li>
                        <a href="/tags/kubernetes">kubernetes</a>
                        </li>
                        
                        <li>
                        <a href="/tags/docker">docker</a>
                        </li>
                        
                        <li>
                        <a href="/tags/container">container</a>
                        </li>
                        
                        <li>
                        <a href="/tags/google-cloud-platform">Google Cloud Platform</a>
                        </li>
                        
                        <li>
                        <a href="/tags/deployment">deployment</a>
                        </li>
                        
                        </ul>
                    </div>
                    
                    
                    
                    <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
                    
                        <a class="prev d-block col-md-6" href="/posts/the-evolutions-of-git-commit-message-conventions-in-kurio/"> &laquo; The Evolutions of Git Commit Message Conventions in Kurio</a>
                    
                    
                        <a class="next d-block col-md-6 text-lg-right" href="/posts/integration-test-with-database-in-golang/">Integration Test With Database in Golang &raquo;</a>
                    
                    <div class="clearfix"></div>
                    </div>
                    
                </div>
                
            </div>
        </div>
        
        <br/> 
        
<div class="container">
    <div id="comments" class="row justify-content-center mb-5">
        <div class="col-md-8">           
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "iman-tumorang" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>               
        </div>
    </div>
</div>


 
    </div>

            </div>
    
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Iman Tumorang @bxcodec.io - All rights reserved
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                
            </div>
        </div>
    </div>
</footer>

        </div>

    
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>    
    
<script src="/js/mediumish.js"></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-106812096-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    </body>
</html>

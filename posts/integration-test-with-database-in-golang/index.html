<!DOCTYPE html>
<html lang="en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="generator" content="Hugo 0.54-DEV" />
	

	<title>
		 
		Integration Test With Database in Golang-Letters From Iman
		

	</title>

	<meta property="og:title" content="Integration Test With Database in Golang - Letters From Iman" /> 
	<meta property="og:description" content="Software testing is a process used to identify the correctness, completeness, and quality of developed computer software." />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://bxcodec.io/posts/integration-test-with-database-in-golang/" />
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
	 crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
	<link href="/css/medium.css" rel="stylesheet">
	<link href="/css/additional.css" rel="stylesheet">
	<link rel="icon" href="https://bxcodec.io/favicon.ico">
	<link rel="apple-touch-icon" href="https://bxcodec.io/apple-touch-icon.png"/>
	
	<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/0*-UTDr5YKx5Buxr-v"/>
	<meta property="og:image:secure_url" content="https://cdn-images-1.medium.com/max/800/0*-UTDr5YKx5Buxr-v"/>
	<meta name="twitter:card" content="summary_large_image" />
		
	<meta name="twitter:site" content="@bxcodec.io" />
	
	<meta name="twitter:creator" content="@bxcodec" />
	
	
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container pr-0">
        
        <a class="navbar-brand" href="https://bxcodec.io">

            
            <span style="font-family:Righteous;">Letters From Iman</span>
            
        </a>
        

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/posts">Blog</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/">About Me</a>
                </li>
                
            </ul>
        </div>
        
    </div>
</nav>


        <div class="site-content">   
            <div class="container">
<div class="mainheading">
    
</div><div class="main-content">
        
        <div class="container">
            <div class="row">
                
                <div class="col-md-2 pl-0"><div class="share">
    <p>Share</p>
    <ul>
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://twitter.com/intent/tweet?text=Integration%20Test%20With%20Database%20in%c2%a0Golang&url=https%3a%2f%2fbxcodec.io%2fposts%2fintegration-test-with-database-in-golang%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=435');return false;">
        <i class="fab fa-twitter"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://facebook.com/sharer.php?u=https%3a%2f%2fbxcodec.io%2fposts%2fintegration-test-with-database-in-golang%2f" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
        <i class="fab fa-facebook-f"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://plus.google.com/share?url=https%3a%2f%2fbxcodec.io%2fposts%2fintegration-test-with-database-in-golang%2f" onclick="window.open(this.href, 'google-share', 'width=550,height=435');return false;">
        <i class="fab fa-google"></i>
        </a>
        </li>

        <li class="ml-1 mr-1">
        <a target="_blank" href="https://www.xing.com/spi/shares/new?url=https%3a%2f%2fbxcodec.io%2fposts%2fintegration-test-with-database-in-golang%2f" onclick="window.open(this.href, 'xing-share', 'width=550,height=435');return false;">
        <i class="fab fa-xing"></i>
        </a>
        </li>        
    </ul>

    
        <div class="sep">
        </div>				
        <ul>
            <li> 
            <a  class="small smoothscroll" href="#disqus_thread"></a>
            </li>
        </ul>
    
</div></div>
                                
                <div class="col-md-9 flex-first flex-md-unordered">
                    <div class="mainheading">
                                                                	
                        
                        
                        
                        <div class="post-top-meta">
                            <div>
                                <img class="author-thumb" src="http://gravatar.com/avatar/01e3584fe39eb72335f13243c3a814a2?s=200" alt="Iman Tumorang">
                            </div>
                            <div >
                                <a  href="https://bxcodec.io" class="link-dark">Iman Tumorang</a><br>
                                <span class="author-description">
                                    Software Engineer - Writer - Open Source Enthusiast - Startup Enthusiast<br>
                                    <i class="far fa-star"></i>
                                    Jan 25, 2019
                                    <i class="far fa-clock clock"></i>
                                    6 min read
                                </span>					
                            </div>
                        </div>			
                        	
                        
                                                     
                        
                        <h1 class="posttitle">Integration Test With Database in Golang</h1> 
                        
                            <h2 class="subtitle">Making a test suite in Go projects with a real live database/service</h2> 
                        
                        
                    </div>

                    
                    
                        <img class="featured-image img-fluid" src="https://cdn-images-1.medium.com/max/800/0*-UTDr5YKx5Buxr-v" alt="thumbnail for this post">
                    
                    
                    
                    
                    <div class="article-post">
                        

<p>Software testing is a process used to identify the correctness, completeness, and quality of developed computer software. There are so many kinds of software testing. Start from unit-testing, load-testing, stress-testing, integration-testing, UI-testing, e2e-testing, and many more.</p>

<p>Every kind of testing have a different purpose, unit-testing aims to test a single unit of function. Load testing aims to measure how reliable our system against a huge request. And Integration testing aims to ensure our system can integrate with the external services without any issues.</p>

<h2 id="integration-testing-in-go">Integration Testing In Go</h2>

<p>In this article, I won&rsquo;t tell any other test except integration testing. This kind test as I said earlier is to ensure that our systems can integrate to external services without any issues.</p>

<p>So with this test, we hope we can avoid any unnecessary error or bug when deploying our applications to the server whatever its environment (staging, production)</p>

<p>So, before moving how to do it in Golang, let me clarify a few things before I explain many things below. Actually, I don&rsquo;t know that this kind of testing is looking good for many people, but this is how we made an integration testing in our company Kurio (my current company when writing this). If you have an any better idea, it really pleasures if you tell us it in the comment below.</p>

<h2 id="preparation-and-tools">Preparation and Tools</h2>

<p>In this article, to make it clear, I&rsquo;ve listed and prepared a few things as my tools and helper here.</p>

<ul>
<li>Docker installed (specifically, docker-compose)</li>
<li>github.com/stretchr/testify for testing package tools</li>
<li>github.com/go-redis/redis for Redis driver</li>
<li>github.com/golang-migrate/migrate for migration package</li>
<li>etc listed in go.mod</li>
</ul>

<p>So I will use 2 kinds of database, and my simple application will connect to this database. What I will explain is, how to make an integration testing against to my both database here.</p>

<p>So I will use MySQL and also Redis well, technically we also can say Redis as a database but NoSQL, if it&rsquo;s not, well just assume it was a database :D.</p>

<h2 id="test-suite">Test Suite</h2>

<p>So let&rsquo;s say I have a project that depends on both of this database, you can look my entire simple projects here: <a href="https://github.com/bxcodec/integration-testing">https://github.com/bxcodec/integration-testing</a></p>

<p>If you look to packages mysql and redis you will find my function handler to connect to each DB itself and also its file test. Each test was a Suite test. A bundle test that will test my handler. To make a suite test it&rsquo;s easy, thanks to <code>github.com/stretchr/testify</code> I can do it with ease.</p>

<p>For example, you can look at my redis package. At suite_test.go I define a RedisSuite struct that will be reusable by any test-file.</p>

<pre><code class="language-go">package redis_test
import (
 &quot;github.com/go-redis/redis&quot;
 &quot;github.com/stretchr/testify/suite&quot;
)
type RedisSuite struct {
 suite.Suite
 Host     string
 Password string
 DB       int
 Client   *redis.Client
}
func (r *RedisSuite) SetupSuite() {
 r.Client = redis.NewClient(&amp;redis.Options{
  Addr:     r.Host,
  Password: r.Password,
  DB:       r.DB,
 })
}
func (r *RedisSuite) TearDownSuite() {
 r.Client.Close()
}
</code></pre>

<p>Thanks to testify package, it really helpful to create a suite test. Later with this struct, I just can easily embed it to my test-file. You can see at  <code>mycache_test.go</code></p>

<script src="https://gist.github.com/bxcodec/efed138319e0e61824f6ebedd6b3ff05.js"></script>

<p>If you look, the cache_test.go file, it&rsquo;s a bit different with the normal file-test. If in normal test-file we ussually have this pattern:</p>

<pre><code class="language-go">func TestXXXX (t *testing.T){} // with testing param
</code></pre>

<p>It always has the testing param in each test. And it&rsquo;s required. But in this case, because I use the testify package, there a bit different how to do the test. And it really matters. To add a test case, we must follow the pattern:</p>

<pre><code class="language-go">func (s TestSuite) TestXXXX(){} //without testing param
</code></pre>

<p>For example, in my redis test-file (cache_test.go), you could see that I have 2 test they are: <code>TestSet</code> and <code>TestGet</code>.</p>

<h2 id="running-the-test">Running The Test</h2>

<p>To run the test, it still the same as usual. Run it with: <code>go test</code>. But, because this test requires live Databases(MySQL and Redis), at first, we need to run a live database in our testing environment.</p>

<p>If we run the testing in our local, then make sure that our required Databases alive and can access from our local pc. If we run the testing in CI/CD server, then we must provide a live database to fulfill the test.</p>

<p>Luckily, in this modern software engineering era, there was a tool like Docker exists. We can run our database in docker container, so we don&rsquo;t have to have a real database leave just for testing needs.</p>

<p>To make it easy, I will use the <code>docker-compose</code> feature, look my <code>docker-compose.yaml</code>.</p>

<script src="https://gist.github.com/bxcodec/8457ed9d7ea50ca87e8fca8139b629c9.js"></script>

<p>With just command <code>docker-compose up -d</code>, then I will have a 2 database live in a docker-container so that I can test it directly with it.</p>

<p>To ease me, I just make it into a <code>Makefile</code>. So before running my integration-test, I need my database already live in container.</p>

<script src="https://gist.github.com/bxcodec/85803f96a20fc086da8904920298eb58.js"></script>

<p>So now, to do my testing I just do it with one command:</p>

<pre><code class="language-shell">$ make integration-test #for integration test
$ make unittest #just for unit-testing
</code></pre>

<p><img src="https://cdn-images-1.medium.com/max/800/1*LAR6wxvcezXOpwqS75RESQ.gif" alt="demo integration testing command with make file" /><br></p>

<blockquote>
<p>demo integration testing command with make file</p>
</blockquote>

<hr />

<h1 id="using-it-with-ci-cd-travis">Using it With CI/CD (Travis)</h1>

<p>Every CI/CD may have different feature. Actually, in my current company (Kurio) we use BuddyWorks as our CI/CD tools, but if I use BuddyWorks here, it will look very easy to do, because, in BuddyWorks, we just drag and drop no scripting :D.</p>

<p>So to make it more fun and more &ldquo;hacky&rdquo; and &ldquo;geeky&rdquo; that looks very terminal based as many people see us the engineer that only working with the terminal and love the black screen :D, so I decided to use Travis CI/CD for this article :D</p>

<h2 id="setup-the-travis-yml-script">Setup the travis.yml script</h2>

<p>Before move forward, first, we need to add our project to travis-ci.com and enable the CI/CD pipeline there.
Later, we just need to add our <code>.travis.yml</code> in our project. For my project, you can look all the entire script of <code>.travis.yml</code> in my repository.</p>

<script src="https://gist.github.com/bxcodec/50a2e52419d3a08af13322591d35d02e.js"></script>

<p>Then later, enable it in Travis,
<img src="https://cdn-images-1.medium.com/max/800/1*kwfpsiR2NXvbfSBMw538Nw.png" alt="find and enable our repo in Travis" /><br></p>

<blockquote>
<p>find and enable our repo in Travis</p>
</blockquote>

<p>And all will run the test in Travis.</p>

<hr />

<h1 id="boilerplate">Boilerplate!!!</h1>

<p>We just add our TestSuite boilerplate based on Database provider and driver-library into separated packages: You can look it here: <a href="https://github.com/golangid/testada">https://github.com/golangid/testada</a></p>

<p>To use this package, for example, you want to make a MySQL integration test, you can directly import the testada/mysql package. And embed directly the MySQL suite structs.</p>

<pre><code class="language-go">import &quot;github.com/golangid/testada/mysql&quot;
type youItemMysqlTestSuite struct {
 mysql.MysqlSuite //embed from testada/mysql
}
func TestYourItemMysqlSuite(t *testing.T) {
 if testing.Short() {
  t.Skip(&quot;Skip you item mysql repository test&quot;)
 }
 dsn := os.Getenv(&quot;MYSQL_TEST_URL&quot;)
 if dsn == &quot;&quot; {
  dsn = &quot;root:root-pass@tcp(localhost:3306)/testing?parseTime=1&amp;loc=Asia%2FJakarta&amp;charset=utf8mb4&amp;collation=utf8mb4_unicode_ci&quot;
 }
 yourItemSuite := &amp;youItemMysqlTestSuite{
  MysqlSuite{
   DSN:                     dsn,
   MigrationLocationFolder: &quot;migrations&quot;,
  },
 }
suite.Run(t, yourItemSuite)
}
</code></pre>

<p>At least, this package already makes the boilerplate like setting the migration (if using migrations) or handle the test-suite setup that will help you work faster. :D</p>

<p>Also, it&rsquo;s required to understand how testify/suite works, before implementing your own integration test like ours.</p>

<hr />

<p>Once again, as I tell at the beginning of this article, this is how we made an integration testing in our company Kurio (my current company when writing this.
If you have an any better idea, it really pleasures if you tell me it in the comment below. But if you found this very useful, please share this with anyone who might need this. ^_^</p>

<hr />

<p><em>Originally posted at: <a href="https://hackernoon.com/integration-test-with-database-in-golang-355dc123fdc9">https://hackernoon.com/integration-test-with-database-in-golang-355dc123fdc9</a></em></p>

                    </div>
                    
                    
                    <div class="after-post-tags">
                        <ul class="tags">
                        
                        <li>
                        <a href="/tags/golang">golang</a>
                        </li>
                        
                        <li>
                        <a href="/tags/ci/cd">ci/cd</a>
                        </li>
                        
                        <li>
                        <a href="/tags/deployment">deployment</a>
                        </li>
                        
                        <li>
                        <a href="/tags/programming">programming</a>
                        </li>
                        
                        <li>
                        <a href="/tags/integration-testing">integration-testing</a>
                        </li>
                        
                        <li>
                        <a href="/tags/travis">travis</a>
                        </li>
                        
                        </ul>
                    </div>
                    
                    
                    
                    <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
                    
                    
                        <a class="next d-block col-md-6 text-lg-right" href="/posts/ci/cd-at-kurio-backend-with-buddy.works/">CI/CD at Kurio Backend with Buddy.Works &raquo;</a>
                    
                    <div class="clearfix"></div>
                    </div>
                    
                </div>
                
            </div>
        </div>
        
         
        
<div class="container">
    <div id="comments" class="row justify-content-center mb-5">
        <div class="col-md-8">           
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "iman-tumorang" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>               
        </div>
    </div>
</div>


 
    </div>
<div class="alertbar">
	<div class="container text-center">
        <span>
            
                <span style="font-family:Righteous;">Letters From Iman</span>
            
            &nbsp; Never miss a <b>story</b>, subscribe to my newsletter
        </span>

        <form action="#ZgotmplZ" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate>
		<input type="email" placeholder="Email" name="EMAIL" autocomplete="on" required>
	    	
	    	<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_4711b43114f183e963e2f7193_0d2c555b4a" tabindex="-1" value=""></div>
		<input type="submit" value="Subscribe" name="subscribe" >
        </form>

	</div>
</div> 

            </div>
    
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Iman Tumorang @bxcodec.io - All rights reserved
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                
            </div>
        </div>
    </div>
</footer>

        </div>

    
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>    
    
<script src="/js/mediumish.js"></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-106812096-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    </body>
</html>
